// Lesson 3 Module
window.lessonModules = window.lessonModules || {};

const lesson3 = {
    vocabulary: [
        {
            "en": "to go",
            "es": "ir",
            "example": "I want to go home.",
            "audio": "L3_go_audio"
        },
        {
            "en": "to come",
            "es": "venir; llegar",
            "example": "When will you come?",
            "audio": "L3_come_audio"
        },
        {
            "en": "to work",
            "es": "trabajar",
            "example": "I work at school.",
            "audio": "L3_work_audio"
        },
        {
            "en": "a, an",
            "es": "un, una",
            "example": "I have a book.",
            "audio": "L3_a_audio"
        },
        {
            "en": "and",
            "es": "y, e",
            "example": "You and me.",
            "audio": "L3_and_audio"
        },
        {
            "en": "to",
            "es": "a",
            "example": "I go to school.",
            "audio": "L3_to_audio"
        },
        {
            "en": "in",
            "es": "en, dentro de",
            "example": "The book is in my bag.",
            "audio": "L3_in_audio"
        },
        {
            "en": "with",
            "es": "con",
            "example": "I work with my brother.",
            "audio": "L3_with_audio"
        },
        {
            "en": "my",
            "es": "mi, mis",
            "example": "This is my phone.",
            "audio": "L3_my_audio"
        },
        {
            "en": "too",
            "es": "también",
            "example": "I work too.",
            "audio": "L3_too_audio"
        },
        {
            "en": "here",
            "es": "acá, aquí",
            "example": "The book is here.",
            "audio": "L3_here_audio"
        },
        {
            "en": "table",
            "es": "mesa",
            "example": "The book is on the table.",
            "audio": "L3_table_audio"
        },
        {
            "en": "telephone",
            "es": "teléfono",
            "example": "My telephone is new.",
            "audio": "L3_telephone_audio"
        },
        {
            "en": "phone",
            "es": "teléfono",
            "example": "This is my phone.",
            "audio": "L3_phone_audio"
        },
        {
            "en": "office",
            "es": "oficina",
            "example": "I work in an office.",
            "audio": "L3_office_audio"
        },
        {
            "en": "school",
            "es": "escuela",
            "example": "The school is big.",
            "audio": "L3_school_audio"
        },
        {
            "en": "movie",
            "es": "película",
            "example": "The movie is in Spanish.",
            "audio": "L3_movie_audio"
        },
        {
            "en": "father",
            "es": "padre, papá",
            "example": "My father works here.",
            "audio": "L3_father_audio"
        },
        {
            "en": "mother",
            "es": "madre, mamá",
            "example": "My mother is a teacher.",
            "audio": "L3_mother_audio"
        },
        {
            "en": "brother",
            "es": "hermano",
            "example": "My brother is young.",
            "audio": "L3_brother_audio"
        },
        {
            "en": "sister",
            "es": "hermana",
            "example": "My sister goes to school.",
            "audio": "L3_sister_audio"
        },
        {
            "en": "Spanish",
            "es": "español",
            "example": "I speak Spanish.",
            "audio": "L3_spanish_audio"
        },
        {
            "en": "teacher",
            "es": "profesor",
            "example": "She is a teacher.",
            "audio": "L3_teacher_audio"
        }
    ],

    // Teaching concepts for Lesson 3
    teachingConcepts: {
        title: "CONCEPTOS",
        explanation: "En esta lección aprenderemos sobre verbos comunes y términos familiares.",
        commonPhrases: [
            { en: "to go to school", es: "ir a la escuela" },
            { en: "to come home", es: "venir a casa" },
            { en: "to work with", es: "trabajar con" },
            { en: "my father", es: "mi padre" },
            { en: "my mother", es: "mi madre" },
            { en: "my brother", es: "mi hermano" },
            { en: "my sister", es: "mi hermana" },
            { en: "in the office", es: "en la oficina" },
            { en: "at school", es: "en la escuela" },
            { en: "on the table", es: "sobre la mesa" }
        ]
    },

    // Exercise 1 - Translation exercise
    translationExercise1: [
        { q: "I'm in the office.", a: "Estoy en la oficina.", audio: "L3_ex1_1" },
        { q: "Am I in the office?", a: "¿Estoy en la oficina?", audio: "L3_ex1_2" },
        { q: "I'm not in the office.", a: "No estoy en la oficina.", audio: "L3_ex1_3" },
        { q: "Am I not in the office?", a: "¿No estoy en la oficina?", audio: "L3_ex1_4" },
        { q: "He's my brother.", a: "Él es mi hermano.", audio: "L3_ex1_5" },
        { q: "The boy is American.", a: "El muchacho es americano.", audio: "L3_ex1_6" },
        { q: "John isn't American.", a: "John no es americano.", audio: "L3_ex1_7" },
        { q: "Is John American?", a: "¿Es John americano?", audio: "L3_ex1_8" },
        { q: "She's Mexican.", a: "Ella es mexicana.", audio: "L3_ex1_9" },
        { q: "She isn't Mexican.", a: "Ella no es mexicana.", audio: "L3_ex1_10" },
        { q: "My father is here.", a: "Mi padre está aquí.", audio: "L3_ex1_11" },
        { q: "My father isn't here.", a: "Mi padre no está aquí.", audio: "L3_ex1_12" },
        { q: "Is Mary here?", a: "¿Está Mary aquí?", audio: "L3_ex1_13" },
        { q: "Isn't Mary here?", a: "¿No está Mary aquí?", audio: "L3_ex1_14" },
        { q: "Where is Mary?", a: "¿Dónde está Mary?", audio: "L3_ex1_15" },
        { q: "She's here.", a: "Ella está aquí.", audio: "L3_ex1_16" }
    ],

    // Teaching concept - Articles a/an
    articlesConcept: {
        title: "LOS ARTÍCULOS A y AN",
        explanation: "El artículo a se emplea antes de palabras que empiezan con sonido de consonante. El artículo an se emplea antes de palabras que empiezan con sonido de vocal.",
        examples: [
            { en: "an American girl", es: "una chica americana" },
            { en: "an office", es: "una oficina" },
            { en: "a boy", es: "un chico" },
            { en: "a Mexican man", es: "un hombre mexicano" }
        ]
    },

    // Exercise 2 - Fill in with a/an
    fillInExercise2: [
        { q: "_____ big desk", a: "a", translation: "un escritorio grande" },
        { q: "_____ red apple", a: "a", translation: "una manzana roja" },
        { q: "_____ Mexican woman", a: "a", translation: "una mujer mexicana" },
        { q: "_____ American woman", a: "an", translation: "una mujer americana" },
        { q: "_____ new office", a: "a", translation: "una oficina nueva" },
        { q: "_____ office", a: "an", translation: "una oficina" },
        { q: "_____ old car", a: "an", translation: "un carro viejo" },
        { q: "_____ young boy", a: "a", translation: "un chico joven" }
    ],

    // Teaching concept - Complements with indefinite articles
    complementsConcept: {
        title: "LOS COMPLEMENTOS CON EL ARTÍCULO INDEFINIDO",
        explanation: "En inglés, los complementos en singular que se pueden contar llevan el artículo indefinido antes del sustantivo. Los complementos en plural no van precedidos de artículo indefinido.",
        examples: [
            { en: "He's a little boy.", es: "El es muchachito." },
            { en: "I'm a teacher.", es: "Soy profesor." },
            { en: "It's a big car.", es: "Es coche grande." },
            { en: "It's water.", es: "Es agua.", note: "No se puede contar agua." },
            { en: "They're little boys.", es: "Son muchachitos." },
            { en: "We're teachers.", es: "Somos profesores." },
            { en: "They're big cars.", es: "Son coches grandes." }
        ]
    },

    // Exercise 3 - Spanish to English translation
    translationExercise3: [
        { q: "Es coche grande.", a: "It's a big car." },
        { q: "¿Es casa chica?", a: "Is it a small house?" },
        { q: "Ella no es muchacha joven.", a: "She isn't a young girl." },
        { q: "¿Es escuela grande?", a: "Is it a big school?" },
        { q: "Soy profesor.", a: "I'm a teacher." },
        { q: "Somos profesores.", a: "We're teachers." },
        { q: "Es coche nuevo.", a: "It's a new car." },
        { q: "¿No es muchacho chico?", a: "Isn't he a little boy?" },
        { q: "No son muchachos chicos.", a: "They aren't little boys." },
        { q: "Es padre.", a: "He's a father." }
    ],

    // Exercise 4 - Sentence forms with indefinite articles
    translationExercise4: [
        {
            q: "A young girl is here.",
            forms: {
                affirmative: "A young girl is here.",
                negative: "A young girl isn't here.",
                interrogative: "Is a young girl here?",
                negativeInterrogative: "Isn't a young girl here?"
            }
        },
        {
            q: "She's a young girl.",
            forms: {
                affirmative: "She's a young girl.",
                negative: "She isn't a young girl.",
                interrogative: "Is she a young girl?",
                negativeInterrogative: "Isn't she a young girl?"
            }
        },
        {
            q: "John is an American boy.",
            forms: {
                affirmative: "John is an American boy.",
                negative: "John isn't an American boy.",
                interrogative: "Is John an American boy?",
                negativeInterrogative: "Isn't John an American boy?"
            }
        },
        {
            q: "An American boy is here.",
            forms: {
                affirmative: "An American boy is here.",
                negative: "An American boy isn't here.",
                interrogative: "Is an American boy here?",
                negativeInterrogative: "Isn't an American boy here?"
            }
        },
        {
            q: "Mr. Green is a young man.",
            forms: {
                affirmative: "Mr. Green is a young man.",
                negative: "Mr. Green isn't a young man.",
                interrogative: "Is Mr. Green a young man?",
                negativeInterrogative: "Isn't Mr. Green a young man?"
            }
        },
        {
            q: "Mr. Smith is an old man.",
            forms: {
                affirmative: "Mr. Smith is an old man.",
                negative: "Mr. Smith isn't an old man.",
                interrogative: "Is Mr. Smith an old man?",
                negativeInterrogative: "Isn't Mr. Smith an old man?"
            }
        },
        {
            q: "He's a Mexican boy.",
            forms: {
                affirmative: "He's a Mexican boy.",
                negative: "He isn't a Mexican boy.",
                interrogative: "Is he a Mexican boy?",
                negativeInterrogative: "Isn't he a Mexican boy?"
            }
        },
        {
            q: "An apple is red.",
            forms: {
                affirmative: "An apple is red.",
                negative: "An apple isn't red.",
                interrogative: "Is an apple red?",
                negativeInterrogative: "Isn't an apple red?"
            }
        },
        {
            q: "A big table is in the house.",
            forms: {
                affirmative: "A big table is in the house.",
                negative: "A big table isn't in the house.",
                interrogative: "Is a big table in the house?",
                negativeInterrogative: "Isn't a big table in the house?"
            }
        },
        {
            q: "An American woman is in the office.",
            forms: {
                affirmative: "An American woman is in the office.",
                negative: "An American woman isn't in the office.",
                interrogative: "Is an American woman in the office?",
                negativeInterrogative: "Isn't an American woman in the office?"
            }
        }
    ],

    // Teaching concept - Present Tense
    presentTenseConcept: {
        title: "EL TIEMPO PRESENTE",
        explanation: "Para conjugar cualquier verbo en el afirmativo del presente (menos los dos verbos be y have), se quita la partícula to del infinitivo y se antepone el pronombre. Con los pronombres de la tercera persona del singular, o sea he, she, it, y con un sustantivo usado en singular como boy, girl, house siempre se añade una s al verbo. Este tiempo se usa para representar acción habitual o un estado o un hecho.",
        examples: [
            { pronoun: "I", en: "come", es: "(yo) vengo" },
            { pronoun: "you", en: "come", es: "(tú) vienes" },
            { pronoun: "you", en: "come", es: "(Ud.) viene" },
            { pronoun: "he", en: "comes", es: "(él) viene" },
            { pronoun: "she", en: "comes", es: "(ella) viene" },
            { pronoun: "it", en: "comes", es: "(cosa) viene" },
            { pronoun: "we", en: "come", es: "(nosotros) venimos" },
            { pronoun: "you", en: "come", es: "(Uds.) vienen" },
            { pronoun: "they", en: "come", es: "(ellos) vienen" },
            { pronoun: "they", en: "come", es: "(ellas) vienen" },
            { pronoun: "they", en: "come", es: "(cosas) vienen" }
        ]
    },

    // Exercise 5 - Verbal Practice
    translationExercise5: [
        { q: "I go to school.", a: "Yo voy a la escuela.", audio: "L3_ex5_1" },
        { q: "You go to school.", a: "Tú vas a la escuela.", audio: "L3_ex5_2" },
        { q: "He goes to school.", a: "Él va a la escuela.", audio: "L3_ex5_3" },
        { q: "She goes to school.", a: "Ella va a la escuela.", audio: "L3_ex5_4" },
        { q: "John goes to school.", a: "John va a la escuela.", audio: "L3_ex5_5" },
        { q: "We go to school.", a: "Nosotros vamos a la escuela.", audio: "L3_ex5_6" },
        { q: "You go to school.", a: "Ustedes van a la escuela.", audio: "L3_ex5_7" },
        { q: "They go to school.", a: "Ellos van a la escuela.", audio: "L3_ex5_8" },
        { q: "Robert goes to school.", a: "Robert va a la escuela.", audio: "L3_ex5_9" },
        { q: "My sister goes to school.", a: "Mi hermana va a la escuela.", audio: "L3_ex5_10" },
        { q: "Mr. Hunt goes to school.", a: "El Sr. Hunt va a la escuela.", audio: "L3_ex5_11" },
        { q: "Miss Hunt goes to school.", a: "La Srta. Hunt va a la escuela.", audio: "L3_ex5_12" },
        { q: "John and I go to school.", a: "John y yo vamos a la escuela.", audio: "L3_ex5_13" },
        { q: "Mrs. Hunt and I go to school.", a: "La Sra. Hunt y yo vamos a la escuela.", audio: "L3_ex5_14" },
        { q: "John and Mary go to school.", a: "John y Mary van a la escuela.", audio: "L3_ex5_15" },
        { q: "The boys go to school too.", a: "Los muchachos van a la escuela también.", audio: "L3_ex5_17" },
        { q: "My brothers go to school too.", a: "Mis hermanos van a la escuela también.", audio: "L3_ex5_18" }
    ],

    // Exercise 6 - Fill in prepositions and translate
    prepositionExercise6: [
        { 
            q: "John goes _______ school.", 
            a: "to",
            translation: "John va a la escuela",
            spanish: "John va a la escuela.",
            hint: "(a)"
        },
        { 
            q: "Robert is _______ the house.", 
            a: "in",
            translation: "Robert está en la casa",
            spanish: "Robert está en la casa.",
            hint: "(en)"
        },
        { 
            q: "The table is _______ the office.", 
            a: "in",
            translation: "La mesa está en la oficina",
            spanish: "La mesa está en la oficina.",
            hint: "(en)"
        },
        { 
            q: "My mother goes _______ the office.", 
            a: "to",
            translation: "Mi madre va a la oficina",
            spanish: "Mi madre va a la oficina.",
            hint: "(a)"
        },
        { 
            q: "John comes _______ the office with Mr. Brown.", 
            a: "to",
            translation: "John viene a la oficina con el Sr. Brown",
            spanish: "John viene a la oficina con el Sr. Brown.",
            hint: "(a)"
        },
        { 
            q: "Mary is _______ school.", 
            a: "in",
            translation: "Mary está en la escuela",
            spanish: "Mary está en la escuela.",
            hint: "(en)"
        },
        { 
            q: "The boys are _______ the car.", 
            a: "in",
            translation: "Los muchachos están en el carro",
            spanish: "Los muchachos están en el carro.",
            hint: "(en)"
        },
        { 
            q: "My sister is _______ the house.", 
            a: "in",
            translation: "Mi hermana está en la casa",
            spanish: "Mi hermana está en la casa.",
            hint: "(en)"
        },
        { 
            q: "My brother goes _______ the movies every day.", 
            a: "to",
            translation: "Mi hermano va al cine todos los días",
            spanish: "Mi hermano va al cine todos los días.",
            hint: "(a)"
        },
        { 
            q: "My brothers are _______ the office.", 
            a: "in",
            translation: "Mis hermanos están en la oficina",
            spanish: "Mis hermanos están en la oficina.",
            hint: "(en)"
        }
    ],

    // Exercise 7 - Read and translate
    translationExercise7: [
        {
            q: "John and Robert go to school with Mary.",
            a: "John y Robert van a la escuela con Mary.",
            audio: "L3_ex7_1"
        },
        {
            q: "He works in a big office.",
            a: "Él trabaja en una oficina grande.",
            audio: "L3_ex7_2"
        },
        {
            q: "Mr. and Mrs. Hunt come to the office.",
            a: "Los Sres. Hunt vienen a la oficina.",
            audio: "L3_ex7_3"
        },
        {
            q: "My mother works in the house.",
            a: "Mi madre trabaja en la casa.",
            audio: "L3_ex7_4"
        },
        {
            q: "My sister works in the house too.",
            a: "Mi hermana trabaja en la casa también.",
            audio: "L3_ex7_5"
        },
        {
            q: "My father is American, and my mother is Mexican.",
            a: "Mi padre es americano, y mi madre es mexicana.",
            audio: "L3_ex7_6"
        },
        {
            q: "Are the apples sweet?",
            a: "¿Son dulces las manzanas?",
            audio: "L3_ex7_7"
        },
        {
            q: "No, the desk isn't new.",
            a: "No, el escritorio no es nuevo.",
            audio: "L3_ex7_8"
        },
        {
            q: "Where are the American boys and girls?",
            a: "¿Dónde están los muchachos y muchachas americanos?",
            audio: "L3_ex7_9"
        },
        {
            q: "The American girls are with my sister.",
            a: "Las muchachas americanas están con mi hermana.",
            audio: "L3_ex7_10"
        },
        {
            q: "Isn't Robert with my sister too?",
            a: "¿No está Robert con mi hermana también?",
            audio: "L3_ex7_11"
        },
        {
            q: "Mary is a little girl, and John is a little boy.",
            a: "Mary es una niña pequeña, y John es un niño pequeño.",
            audio: "L3_ex7_12"
        }
    ],

    // Exercise 8 - Spanish to English translation
    translationExercise8: [
        {
            q: "Mi hermano pequeño va a la escuela.",
            a: "My little brother goes to school."
        },
        {
            q: "Mi hermana va a la escuela todos los días.",
            a: "My sister goes to school every day."
        },
        {
            q: "¿Es Ud. mexicano? Sí, yo soy mexicano.",
            a: "Are you Mexican? Yes, I'm Mexican."
        },
        {
            q: "¿Están las muchachas con Roberto? No, están en la casa.",
            a: "Are the girls with Robert? No, they're in the house."
        },
        {
            q: "Juan está con mi mamá también.",
            a: "John is with my mother too."
        },
        {
            q: "Mis hermanos no son pequeños. Son grandes.",
            a: "My brothers aren't little. They're big."
        },
        {
            q: "Mis hermanos trabajan en una oficina, y mi padre trabaja en una oficina también.",
            a: "My brothers work in an office, and my father works in an office too."
        },
        {
            q: "¿Dónde están los muchachos americanos?",
            a: "Where are the American boys?"
        },
        {
            q: "La Srita. Davis no está en la escuela.",
            a: "Miss Davis isn't at school."
        },
        {
            q: "El Sr. Hunt va al cine. La Sra. Hunt va al cine también.",
            a: "Mr. Hunt goes to the movies. Mrs. Hunt goes to the movies too."
        }
    ],

    // Exercise 9 - Dictation exercise
    dictationExercise9: [
        {
            text: "Robert is here too.",
            audio: "L3_ex9_1",
            audioFile: "audio/L3/ex9_1.mp3"
        },
        {
            text: "My father comes to the office every day.",
            audio: "L3_ex9_2",
            audioFile: "audio/L3/ex9_2.mp3"
        },
        {
            text: "My father and mother are here.",
            audio: "L3_ex9_3",
            audioFile: "audio/L3/ex9_3.mp3"
        },
        {
            text: "Where are the Mexican boys?",
            audio: "L3_ex9_4",
            audioFile: "audio/L3/ex9_4.mp3"
        },
        {
            text: "Aren't you Mexican? No, I'm American.",
            audio: "L3_ex9_5",
            audioFile: "audio/L3/ex9_5.mp3"
        },
        {
            text: "Miss Taylor works in a big office.",
            audio: "L3_ex9_6",
            audioFile: "audio/L3/ex9_6.mp3"
        },
        {
            text: "John goes to school in a car.",
            audio: "L3_ex9_7",
            audioFile: "audio/L3/ex9_7.mp3"
        },
        {
            text: "We go to school too.",
            audio: "L3_ex9_8",
            audioFile: "audio/L3/ex9_8.mp3"
        },
        {
            text: "My sisters go to the movies every day.",
            audio: "L3_ex9_9",
            audioFile: "audio/L3/ex9_9.mp3"
        },
        {
            text: "Is the man here?",
            audio: "L3_ex9_10",
            audioFile: "audio/L3/ex9_10.mp3"
        }
    ],

    // Exercise 10 - Conversation with affirmative and negative answers
    conversationExercise10: [
        {
            q: "Are you Mexican?",
            affirmative: "Yes, I am Mexican.",
            negative: "No, I am not Mexican.",
            audio: "L3_ex10_1",
            audioFile: "audio/L3/ex10_1.mp3"
        },
        {
            q: "Isn't the boy here?",
            affirmative: "Yes, the boy is here.",
            negative: "No, the boy isn't here.",
            audio: "L3_ex10_2",
            audioFile: "audio/L3/ex10_2.mp3"
        },
        {
            q: "Are the girls in the house?",
            affirmative: "Yes, the girls are in the house.",
            negative: "No, the girls aren't in the house.",
            audio: "L3_ex10_3",
            audioFile: "audio/L3/ex10_3.mp3"
        },
        {
            q: "Aren't the boys brothers?",
            affirmative: "Yes, the boys are brothers.",
            negative: "No, the boys aren't brothers.",
            audio: "L3_ex10_4",
            audioFile: "audio/L3/ex10_4.mp3"
        },
        {
            q: "Is the boy little?",
            affirmative: "Yes, the boy is little.",
            negative: "No, the boy isn't little.",
            audio: "L3_ex10_5",
            audioFile: "audio/L3/ex10_5.mp3"
        },
        {
            q: "Is Robert an American?",
            affirmative: "Yes, Robert is an American.",
            negative: "No, Robert isn't an American.",
            audio: "L3_ex10_6",
            audioFile: "audio/L3/ex10_6.mp3"
        },
        {
            q: "Are the boys in the car?",
            affirmative: "Yes, the boys are in the car.",
            negative: "No, the boys aren't in the car.",
            audio: "L3_ex10_7",
            audioFile: "audio/L3/ex10_7.mp3"
        },
        {
            q: "Isn't the little boy Mexican?",
            affirmative: "Yes, the little boy is Mexican.",
            negative: "No, the little boy isn't Mexican.",
            audio: "L3_ex10_8",
            audioFile: "audio/L3/ex10_8.mp3"
        },
        {
            q: "Aren't the girls with John?",
            affirmative: "Yes, the girls are with John.",
            negative: "No, the girls aren't with John.",
            audio: "L3_ex10_9",
            audioFile: "audio/L3/ex10_9.mp3"
        },
        {
            q: "Are they sisters?",
            affirmative: "Yes, they are sisters.",
            negative: "No, they aren't sisters.",
            audio: "L3_ex10_10",
            audioFile: "audio/L3/ex10_10.mp3"
        },
        {
            q: "Are they brothers?",
            affirmative: "Yes, they are brothers.",
            negative: "No, they aren't brothers.",
            audio: "L3_ex10_11",
            audioFile: "audio/L3/ex10_11.mp3"
        },
        {
            q: "Is the man American?",
            affirmative: "Yes, the man is American.",
            negative: "No, the man isn't American.",
            audio: "L3_ex10_12",
            audioFile: "audio/L3/ex10_12.mp3"
        },
        {
            q: "Isn't Robert with Mr. Hunt?",
            affirmative: "Yes, Robert is with Mr. Hunt.",
            negative: "No, Robert isn't with Mr. Hunt.",
            audio: "L3_ex10_13",
            audioFile: "audio/L3/ex10_13.mp3"
        },
        {
            q: "Is Mary with Miss Hunt?",
            affirmative: "Yes, Mary is with Miss Hunt.",
            negative: "No, Mary isn't with Miss Hunt.",
            audio: "L3_ex10_14",
            audioFile: "audio/L3/ex10_14.mp3"
        },
        {
            q: "Is John a big boy?",
            affirmative: "Yes, John is a big boy.",
            negative: "No, John isn't a big boy.",
            audio: "L3_ex10_15",
            audioFile: "audio/L3/ex10_15.mp3"
        }
    ],

    // Audio recording and playback functions
    playAudio: function(audioId) {
        const audio = new Audio(`../audio/lesson3/${audioId}.mp3`);
        audio.play().catch(error => {
            console.error('Error playing audio:', error);
            // Fallback to speech synthesis if audio file fails to play
            if (error.name === 'NotSupportedError' || error.name === 'NotFoundError') {
                const text = this.dictationExercise9.find(item => item.audio === audioId)?.text || '';
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        });
    },

    startRecording: function(audioId) {
        const recordBtn = document.querySelector(`button[onclick*="${audioId}"].record-btn`);
        const playbackBtn = document.querySelector(`button[onclick*="${audioId}"].play-recording-btn`);
        const statusDiv = recordBtn.closest('.dictation-item').querySelector('.recording-status');

        if (window.audioRecorder.isRecording) {
            window.audioRecorder.stopRecording().then(audioUrl => {
                recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                recordBtn.classList.remove('recording');
                playbackBtn.disabled = false;
                statusDiv.textContent = 'Recording saved!';
                
                // Store the audio URL for playback
                const audioElement = document.createElement('audio');
                audioElement.id = `recording-${audioId}`;
                audioElement.src = audioUrl;
                document.body.appendChild(audioElement);
            });
        } else {
            window.audioRecorder.startRecording().then(() => {
                recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
                recordBtn.classList.add('recording');
                statusDiv.textContent = 'Recording...';
            }).catch(error => {
                console.error('Failed to start recording:', error);
                statusDiv.textContent = 'Error: Could not start recording';
            });
        }
    },

    playRecording: function(audioId) {
        const audioElement = document.getElementById(`recording-${audioId}`);
        if (audioElement && audioElement.src) {
            audioElement.play();
        }
    },

    // Initialize the lesson
    initialize: async function() {
        console.log('Starting Lesson 3 initialization...');
        
        // Initialize lesson state with vocabulary
        if (!window.lessonStates) {
            window.lessonStates = {};
        }
        
        window.lessonStates['L3'] = {
            currentFlashcardIndex: 0,
            isFlipped: false,
            vocabulary: this.vocabulary,
            initialized: true
        };

        try {
            // Initialize flashcards
            const flashcardContainer = document.querySelector('.flashcard-container');
            if (flashcardContainer) {
                window.flashcardModule.initializeFlashcards(flashcardContainer, this.vocabulary);
            } else {
                console.error('Flashcard container not found');
            }

            // Initialize exercises
            await this.initializeExercises();

            console.log('Lesson 3 initialization completed successfully');
        } catch (error) {
            console.error('Error during Lesson 3 initialization:', error);
            throw error;
        }
    },

    initializeExercises: async function() {
        // Initialize exercises
        const exercise1Container = document.getElementById('exercise1-L3');
        if (exercise1Container) {
            window.exerciseModule.initializeExercise(exercise1Container, this.translationExercise1, 'translation');
        }

        const exercise2Container = document.getElementById('exercise2-L3');
        if (exercise2Container) {
            window.exerciseModule.initializeExercise(exercise2Container, this.fillInExercise2, 'fillIn');
        }

        const exercise3Container = document.getElementById('exercise3-L3');
        if (exercise3Container) {
            window.exerciseModule.initializeExercise(exercise3Container, this.translationExercise3, 'translation');
        }

        const exercise4Container = document.getElementById('exercise4-L3');
        if (exercise4Container) {
            window.exerciseModule.initializeExercise(exercise4Container, this.translationExercise4, 'multiForm', {
                formTypes: ['negative', 'interrogative', 'negativeInterrogative']
            });
        }

        const exercise5Container = document.getElementById('exercise5-L3');
        if (exercise5Container) {
            window.exerciseModule.initializeExercise(exercise5Container, this.translationExercise5, 'translation');
        }

        const exercise6Container = document.getElementById('exercise6-L3');
        if (exercise6Container) {
            window.exerciseModule.initializeExercise(exercise6Container, this.prepositionExercise6, 'fillInWithTranslation', {
                labels: ['Preposición:', 'Traducción:'],
                checkFirstInput: true
            });
        }

        const exercise7Container = document.getElementById('exercise7-L3');
        if (exercise7Container) {
            window.exerciseModule.initializeExercise(exercise7Container, this.translationExercise7, 'translation');
        }

        const exercise8Container = document.getElementById('exercise8-L3');
        if (exercise8Container) {
            window.exerciseModule.initializeExercise(exercise8Container, this.translationExercise8, 'translation');
        }

        const exercise9Container = document.getElementById('exercise9-L3');
        if (exercise9Container) {
            window.exerciseModule.initializeExercise(exercise9Container, this.dictationExercise9, 'dictation');
        }

        const exercise10Container = document.getElementById('exercise10-L3');
        if (exercise10Container) {
            window.exerciseModule.initializeExercise(exercise10Container, this.conversationExercise10, 'conversation', {
                labels: {
                    affirmative: 'Respuesta Afirmativa:',
                    negative: 'Respuesta Negativa:'
                }
            });
        }
    }
};

// Register the lesson module
window.lessonModules.lesson3 = lesson3; 